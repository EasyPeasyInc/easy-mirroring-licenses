name: Auto‑Delete License Files After 3 Hours

on:
  schedule:
    - cron: '0 * * * *'    # every hour
  workflow_dispatch:      # manual trigger

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: List all .txt files in repo root
        run: |
          echo "=== All .txt files in repo root ==="
          find . -maxdepth 1 -type f -name '*.txt' -print

      - name: List .txt files older than 3 hours
        run: |
          echo "=== Candidate files (older than 3h) ==="
          find . -maxdepth 1 -type f -name '*.txt' -mmin +180 -print || true

      - name: Delete .txt files older than 3 hours
        run: |
          echo "=== Deleting old license files ==="
          find . -maxdepth 1 -type f -name '*.txt' -mmin +180 -print -delete || true

      - name: Show git status
        run: |
          git status

      - name: Commit & push deletions
        uses: EndBug/add-and-commit@v7
        with:
          author_name: 'GitHub Actions'
          author_email: 'actions@github.com'
          message: 'Auto‑delete license files older than 3 hours'
          add: '.'        # stage all changes (including deletions)

